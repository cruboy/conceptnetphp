/*********************************************************************
* all jquery-plugin apply at jquery-1.3.2 or later                   *
* @author fanxiaojie <ms.fanxiaojie@163.com>                         *
* @site http://www.asprain.com/                                      *
* @licence LGPL(http://www.opensource.org/licenses/lgpl-license.php) *
**********************************************************************/
(function($){
$.fn.fade=function(v){var $this=$(this);$this.fadeOut(v,function(){$this.remove();});}
$.fn.fbox=function(settings){if($.browser.msie&&($.browser.version==6.0))return;var opts={},imgPreloader=new Image,imgTypes=['png','jpg','jpeg','gif'],loadingTimer;var start=function(el,o){if(opts.animating)return false;if(o.overlayShow){$("#f_wrap").prepend('<div id="f_overlay"></div>');$("#f_overlay").css({'width':$(window).width(),'height':$(document).height(),'opacity':o.overlayOpacity});$("#f_overlay").click(function(){close()});}opts.itemArray=[];var item={url:el.href,title:el.title,o:o};if(o.zoomSpeedIn>0||o.zoomSpeedOut>0){var c=$(el).children("img:first").length?$(el).children("img:first"):$(el);item.orig={'width':c.width(),'height':c.height(),'pos':getPosition(c)}}opts.itemArray=item;loadItem();};var loadItem=function(n){showLoading();$("#f_nav").empty();$("#f_outer").stop();$("#f_title").hide();$(document).unbind("keydown");imgRegExp=imgTypes.join('|');imgRegExp=new RegExp('\.'+imgRegExp+'$','i');var url=opts.itemArray.url;if(url.match(imgRegExp)){$(imgPreloader).unbind('load').bind('load',function(){$("#f_loading").hide();opts.itemArray.o.frameWidth=imgPreloader.width;opts.itemArray.o.frameHeight=imgPreloader.height;showItem('<img id="f_img" src="'+imgPreloader.src+'" />');}).attr('src',url+'?rand='+Math.floor(Math.random()*999999999));}else{close();window.open(url);}};var showItem=function(val){var viewportPos=getViewport();var itemSize=getMaxSize(viewportPos[0]-50,viewportPos[1]-100,opts.itemArray.o.frameWidth,opts.itemArray.o.frameHeight);var itemLeft=viewportPos[2]+Math.round((viewportPos[0]-itemSize[0])/2)-20;var itemTop=viewportPos[3]+Math.round((viewportPos[1]-itemSize[1])/2)-40;var itemOpts={'left':itemLeft,'top':itemTop,'width':itemSize[0] +'px','height':itemSize[1]+'px'};if(opts.active){$('#f_content').fadeOut("normal",function(){$("#f_content").empty();$("#f_outer").animate(itemOpts,"normal",function(){$("#f_content").append($(val)).fadeIn("normal");updateDetails();});	});}else{opts.active=true;$("#f_content").empty();if($("#f_content").is(":animated")){console.info('animated!');	}if(opts.itemArray.o.zoomSpeedIn>0){opts.animating=true;itemOpts.opacity="show";$("#f_outer").css({'top':opts.itemArray.orig.pos.top-18,'left':opts.itemArray.orig.pos.left-18,'height':opts.itemArray.orig.height,'width':opts.itemArray.orig.width});$("#f_content").append($(val)).show();$("#f_outer").animate(itemOpts, opts.itemArray.o.zoomSpeedIn,function(){opts.animating=false;updateDetails();});}else{$("#f_content").append($(val)).show();	$("#f_outer").css(itemOpts).show();	updateDetails();}}};var updateDetails=function(){if(opts.itemArray.title!==undefined&&opts.itemArray.title!==''){$('#f_title div').html(opts.itemArray.title);$('#f_title').show();}if(opts.itemArray.o.hideOnContentClick){$("#f_content").click(function(){close()});}else{$("#f_content").unbind('click');}$(document).keydown(function(event){if(event.keyCode==27){close();}});};var close=function(){if(opts.animating)return false;$(imgPreloader).unbind('load');$(document).unbind("keydown");$("#f_loading,#f_title").hide();$("#f_nav").empty();opts.active=false;if(opts.itemArray.o.zoomSpeedOut>0){var itemOpts={'top':opts.itemArray.orig.pos.top-18,'left':opts.itemArray.orig.pos.left-18,'height':opts.itemArray.orig.height,'width':opts.itemArray.orig.width,'opacity':'hide'};opts.animating=true;$("#f_outer").animate(itemOpts,opts.itemArray.o.zoomSpeedOut,function(){$("#f_content").hide().empty();$("#f_overlay,#f_bigIframe").remove();opts.animating=false;});}else{$("#f_outer").hide();$("#f_content").hide().empty();$("#f_overlay,#f_bigIframe").fade("fast");}};var showLoading=function(){clearInterval(loadingTimer);var pos=getViewport();$("#f_loading").css({'left':((pos[0]-40)/2+pos[2]),'top':((pos[1]-40)/2+pos[3])}).show();$("#f_loading").bind('click',function(){close()});};var init=function(){if(!$('#f_wrap').length){$('<div id="f_wrap"><div id="f_loading"></div><div id="f_outer"><div id="f_inner"><div id="f_nav"></div><div id="f_content"></div><div id="f_title"></div></div></div></div>').appendTo("body");$('<table cellspacing="0" cellpadding="0" border="0" width="100%"><tr><td id="f_title_left"></td><td id="f_title_main"><div></div></td><td id="f_title_right"></td></tr></table>').appendTo('#f_title');}if(jQuery.fn.pngFix)$(document).pngFix();};var getPosition=function(el){var pos=el.offset();pos.top+=num(el,'paddingTop');pos.top+=num(el,'borderTopWidth');pos.left+=num(el,'paddingLeft');pos.left+=num(el,'borderLeftWidth');return pos;};var num=function(el,prop){return parseInt($.curCSS(el.jquery?el[0]:el,prop,true))||0;};var getViewport=function(){var scroll=$.getPageScroll();return[$(window).width(),$(window).height(),scroll.X,scroll.Y];};var getMaxSize=function(maxWidth,maxHeight,imageWidth,imageHeight){var r=Math.min(Math.min(maxWidth,imageWidth)/imageWidth,Math.min(maxHeight,imageHeight)/imageHeight);return[Math.round(r*imageWidth),Math.round(r*imageHeight)];};init();return this.each(function(){var $this=$(this);var o=settings||{};o.hideOnContentClick=true;o.zoomSpeedIn=400;o.zoomSpeedOut=200;o.frameWidth=600;	o.frameHeight=400;o.overlayShow=true;o.overlayOpacity=0.4;$this.unbind('click').click(function(){start(this,o);return false;});});};

$.msgbox=function(o){if(typeof(o)=='string'){o={content:o};}var options=o||{};options.width=o.width||360;options.height=o.height||200;options.closeAfter=o.closeAfter||0;options.title=o.title||'attention';options.wrapperClass='msg_wrapper';options.titleClass='msg_title';options.outClickClose=o.outClickClose=='yes'?true:false;options.titleWrapperClass='msg_title_wrapper';options.mainClass='msg_main';options.bgClass='msg_bg';options.type=o.type||'text';options.content=o.content||'Hello,world!';options.closeEvent=o.closeEvent||function(){};options.closeImg='images/blank.gif';options.bgOpacity=o.bgOpacity||0.4;options.afterAjaxEvent=o.afterAjaxEvent||function(){};options.couldClose=o.couldClose||'yes';options.oneBoxMode=typeof(o.oneBoxMode)=='undefined'?true:o.oneBoxMode;var dragFlag=false;var startX=0;var startY=0;var $background=$(document.createElement("div")).addClass(options.bgClass).css({"opacity":0.0}).appendTo('body').animate({opacity:options.bgOpacity}).mouseup(dragEnd);if (options.outClickClose)$background.click(closeMe);else{$background.dblclick(closeMe).click(function(){flashTitle(0.5,4,80);})};try{$background.bgiframe();}catch(e){};var $wrapper=$(document.createElement("div")).css({'width':options.width+'px','height':options.height+'px','position':'absolute','z-index':'100'}).addClass(options.wrapperClass).appendTo('body').mouseup(dragEnd);var $titleWrapper=$(document.createElement("div")).addClass(options.titleWrapperClass).appendTo($wrapper).select(function(e){if(e.preventDefault)e.preventDefault();if(e.stopPropagation())e.stopPropagation();return false;}).mousedown(function(e){dragStart(e);}).mousemove(function(e){if(dragFlag)dragTo(startX,startY,e);}).mouseout(function(e){if(dragFlag)dragTo(startX,startY,e);}).mouseup(dragEnd);var $title=$(document.createElement("span")).html(options.title).appendTo($titleWrapper).addClass(options.titleClass).select(function(e){if(e.preventDefault)e.preventDefault();if(e.stopPropagation())e.stopPropagation();return false;}).mouseup(dragEnd);var $close=$(document.createElement("img")).attr({'src':options.closeImg,'className':'right'}).prependTo($titleWrapper).mousedown(closeMe);var $main=$(document.createElement("div")).addClass(options.mainClass).appendTo($wrapper).height(options.height-51).mouseup(dragEnd);function closeMe(){if(options.couldClose=='yes'){$background.fade('slow');$wrapper.slideUp("slow");	}else flashTitle(0.5,4,80);}function isVisible(){return $background.is(":visible")&&$wrapper.is(":visible");}function autoCloseMe(closeAfter){if(closeAfter>0&&isVisible()){autoCloseStr=" ("+closeAfter+')';$title.html(options.title+" &nbsp; "+autoCloseStr);closeAfter--;if(closeAfter==0)closeMe();setTimeout(function(){autoCloseMe(closeAfter)},1000);}}function dragStart(e){if(e.preventDefault)e.preventDefault();if(e.stopPropagation())e.stopPropagation();dragFlag=true;var offset=$wrapper.offset();startX=e.pageX-offset.left;startY=e.pageY-offset.top;}function dragTo(x,y,e){if(e.preventDefault)e.preventDefault();if(e.stopPropagation())e.stopPropagation();ensureMoveInScreen(e.pageX-x,e.pageY-y);}function ensureMoveInScreen(x,y){var page=$.getPageSize();var offset=$wrapper.offset();if(x<0)boxMoveTo(0,y);if(y<0)boxMoveTo(x,0);if(offset.left>page.PageW-options.width)boxMoveTo(page.PageW-options.width,y);if(offset.top>page.PageH-options.height)boxMoveTo(x,page.PageH-options.height);if(x>=0&&x<=page.PageW-options.width&&y>=0&&y<=page.PageH-options.height)boxMoveTo(x,y);}function boxMoveTo(x,y){var scroll=$.getPageScroll;		$wrapper.css({'top':y,'left':x});}function dragEnd(){var offset=$wrapper.offset();ensureMoveInScreen(offset.left,offset.top);dragFlag=false;}function resetPosition(){var page=$.getPageSize();$background.css({'width':page.PageW+'px','height':page.PageH+'px'});var scroll=$.getPageScroll();$wrapper.css({'top':((600-options.height)/2+scroll.Y)+'px','left':($(window).width()-options.width)/2+'px'});}function flashTitle(opacity,times,interval,flag){if(times>0){flag=!flag;	op=flag?opacity:1;$titleWrapper.css('opacity',op);setTimeout(function(){flashTitle(opacity,times-1,interval,flag)},interval);}}var timeOut;function bindIframeMouseup(index){try{window.frames[index].document.onmouseup=dragEnd;}catch(e){};timeOut=setTimeout(function(){	bindIframeMouseup(index)},200);}function msgbox(){switch(options.type){case 'text':$main.html(options.content);$(".closeMe",$main).click(function(){closeMe();});options.afterAjaxEvent();if(self!=top&&options.oneBoxMode){$background.remove();$wrapper.remove();$('body').replaceWith($main);}break;case 'confirm':$main.html('<img src="images/confirm.gif" style="float:left;" width="60" height="50"/>  '+options.content);var $p=$("<p class=\"pp\"></p>").appendTo($main);var $yes=$("<button>\u786E\u5B9A</button>").appendTo($p).click(function(){closeMe();options.closeEvent();});var $no=$("<button>\u53D6\u6D88</button>").appendTo($p).click(function(){closeMe();});break;case 'alert':$main.html('<img src="images/alert.gif" style="float:left;" width="60" height="50"/>  '+options.content);var $p=$("<span></span>").appendTo($main);var $yes=$("<button>\u786E\u5B9A</button>").appendTo($p).click(function(){closeMe();options.closeEvent();});break;case 'get':case 'ajax':case 'url':$main.html("<img src=\"images/loading.gif\" />&nbsp;Loading ...").load(options.content,'',function(data){$.msgform($main);$(".closeMe",$main).click(function(){closeMe();});(options.afterAjaxEvent)(data);});break;	case 'iframe':if(self!=top&&options.oneBoxMode){$background.remove();$wrapper.remove();setTimeout(function(){window.location.href=options.content;},1);}else{$main.css({"padding":0,"height":options.height-27});}break;}}resetPosition();$(window).load(resetPosition).resize(resetPosition).mouseup(dragEnd);if(options.closeAfter>0)autoCloseMe(options.closeAfter);msgbox();}
$.popbox=function(o){var options=o||{};options.width=o.width||240;options.height=o.height||200;options.type=o.type||"text";options.content=o.content||"content here";	var $popWrap=$(document.createElement("div")).addClass("popwrap").appendTo('body');var $popTop=$(document.createElement("div")).addClass("poptopdown").appendTo($popWrap);var $popmain=$(document.createElement("div")).css({"background":"#fff","overflow":"hidden"}).appendTo($popWrap).html(options.content);options.width=$popWrap.width();options.height=$popWrap.height();$popWrap.css({"width":options.width,"height":"10px"});$popWrap.animate({"height":options.height,"width":options.width},300);$popTop.css({'width':options.width,'height':10}).toggle(function(){$popWrap.animate({"height":10,"width":options.width},300);$popTop.removeClass().addClass("poptopup");},function(){$popWrap.animate({"height":options.height,"width":options.width},300);$popTop.removeClass().addClass("poptopdown")});return this;}
$.getPageScroll=function(){var x,y;if(window.pageYOffset){y=window.pageYOffset;x=window.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){y=document.documentElement.scrollTop;x=document.documentElement.scrollLeft;}else if(document.body){y=document.body.scrollTop;x=document.body.scrollLeft;}return{X:x,Y:y};}
$.getPageSize=function(){var scrW,scrH;if(window.innerHeight&&window.scrollMaxY){scrW=window.innerWidth+window.scrollMaxX;scrH=window.innerHeight+window.scrollMaxY;	}else if(document.body.scrollHeight>document.body.offsetHeight){scrW=document.body.scrollWidth;scrH=document.body.scrollHeight;}else if(document.body){scrW=document.body.offsetWidth;scrH=document.body.offsetHeight;}var winW,winH;if(window.innerHeight){winW=window.innerWidth;winH=window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){winW=document.documentElement.clientWidth;winH=document.documentElement.clientHeight;}else if(document.body){winW=document.body.clientWidth;winH=document.body.clientHeight;}var pageW=(scrW<winW)?winW:scrW;var pageH=(scrH<winH)?winH:scrH;return{PageW:pageW,PageH:pageH,WinW:winW,WinH:winH};}
$.confirm=function(content,callback){$.msgbox({'title':"\u786E\u8BA4\u6846","height":110,"width":300,'content':content,"type":"confirm","closeEvent":callback});return false;}
$.alert=function(content,callback){$.msgbox({'title':"\u8B66\u544A\u6846","height":110,"width":300,'content':content,"type":"alert","closeAfter":3,"closeEvent":callback});return false;}
$.fn.pickColor=function(callback){var pos=$(this).offset();var left=pos.left;var top=pos.top+16;itemColors=["#FAFAFA","#E8E8E8","#AFAFAF","#969696","#7D7D7D","#646464","#4B4B4B","#333333","#1A1A1A","#000000","#FEFCDF","#FEF4C4","#FEED9B","#FEE573","#FFED43","#F6CC0B","#E0B800","#C9A601","#AD8E00","#8C7301","#FFDED3","#FFC4B0","#FF9D7D","#FF7A4E","#FF6600","#E95D00","#D15502","#BA4B01","#A44201","#8D3901","#FFD2D0","#FFBAB7","#FE9A95","#FF7A73","#FF483F","#FE2419","#F10B00","#D40A00","#940000","#6D201B","#FFDAED","#FFB7DC","#FFA1D1","#FF84C3","#FF57AC","#FD1289","#EC0078","#D6006D","#BB005F","#9B014F","#FCD6FE","#FBBCFF","#F9A1FE","#F784FE","#F564FE","#F546FF","#F328FF","#D801E5","#C001CB","#8F0197","#E2F0FE","#C7E2FE","#ADD5FE","#92C7FE","#6EB5FF","#48A2FF","#2690FE","#0162F4","#013ADD","#0021B0","#D3FDFF","#ACFAFD","#7CFAFF","#4AF7FE","#1DE6FE","#01DEFF","#00CDEC","#01B6DE","#00A0C2","#0084A0","#EDFFCF","#DFFEAA","#D1FD88","#BEFA5A","#A8F32A","#8FD80A","#79C101","#3FA701","#307F00","#156200","#D4C89F","#DAAD88","#C49578","#C2877E","#AC8295","#C0A5C4","#969AC2","#92B7D7","#80ADAF","#9CA53B"];var $colorBox=$(document.createElement("div")).css({"width":"100px","left":left,"top":top,"border":"1px solid #999999","position":"absolute","line-height":"10px"});$.each(itemColors,function(n,v){var $item=$('<a href="" title="'+v+'"><img src="images/space.gif" width="10" height="10" border="0" style="background:'+v+';margin:0;vertical-align:baseline;" /></a>').click(function(){callback(v);$colorBox.remove();return false;}).appendTo($colorBox);});$colorBox.appendTo(document.body).hover(function(){},function(){$colorBox.remove();});}

$.fn.page=function(){var $y=this;var table=$("tr:has(td)",$y);var row=table.length;var pageSize=parseInt($y.attr("cols"));var allPage=parseInt(((row+pageSize-1)/pageSize),10);if(allPage==1) return false;var currentPage=1;table.hide();var $menu=$("caption",$y);$menu.append("<span id='pre'>&laquo;</span>");for(var i=1;i<=allPage;i++){$("<span>"+i+"</span>").click(function(){showRow($("span",$menu).index(this));}).appendTo($menu);}$menu.append("<span id=\"next\">&raquo;</span>");$("#pre").click(function(){showPre();});$("#next").click(function(){showNext();});showRow(1);$y.removeClass();function showRow(page){currentPage=parseInt(page);table.hide();var first=(currentPage-1)*pageSize;var last=pageSize*currentPage;if(last>row) last=row;for(var i=first;i<last;i++){table.eq(i).show();}$("span",$menu).removeClass("current");$("span:eq("+currentPage+")",$menu).addClass("current")	}function showPre(){var p;if(currentPage==1){p=allPage;}else{p=currentPage-1;};showRow(p);}function showNext(){var p;if(currentPage==allPage){p=1;}else{p=currentPage+1;}showRow(p);}}

$.form=function(obj){$("form",obj).each(function(){var $this=$(this);
var action=$this.attr("action")||"";var method=$this.attr("method")||"get";$this.submit(function(){if(eval($this.attr("submit"))==false)return false;var dataArr=new Array;$("input[type=text],input[type=password],input[type=hidden],input[checked],textarea,select",$this).each(function(){dataArr.push(this.name+'='+escape(this.value.replace(/\%/g,"%25").replace(/\\/g,"%5C").replace(/\・/g,"%B7")).replace(/\+/g,"%2B"));});
if(method=='post'){if(action.indexOf('json')==-1)action="json/"+action;$.msgbox({'title':'&nbsp;','height':100,'width':270,'content':'<img src="images/1000516.gif" /> 提交中…','type':'text','couldClose':'no','afterAjaxEvent':function(){var $box=$("div.msg_main");$.ajax({type:"POST",cache:false,url:action,data:dataArr.join('&'),dataType:"json",success:function(data){if(data.err){$box.html('<img src="images/1000216.gif" /> '+data.err);}else{$box.html('<img src="images/1000716.gif" /> '+data.msg);}if(data.func){eval(data.func);return false;}else if(data.reload){window.setTimeout("window.location.reload()",1000);return false;}else if(data.html){$this.load(data.html,function(){$.form($this);});$("div.msg_bg").fade('slow');$("div.msg_wrapper").slideUp("slow");}else if(data.url){$box.html($box.html()+"<a href=\"javascript:window.location.reload();\">如果不跳转请点此</a>");setTimeout(function(){window.location.href=data.url;},1000);}else{$box.html($box.html()+"本窗口将在两秒内自动关闭");setTimeout(function(){$("div.msg_bg").fade('slow');$("div.msg_wrapper").slideUp("slow");},2000);}},timeout:10000,global:false,error:function(){$box.html('<img src="images/1000216.gif" /> \u63D0\u4EA4\u5931\u8D25\uFF01');setTimeout(function(){$("div.msg_bg").fade('slow');$("div.msg_wrapper").slideUp("slow");},500);}});}});}else{window.location.href=action+'?'+dataArr.join('&');}return false;});});$("input[click]",obj).each(function(){eval($(this).attr("click"))});$("a[target=msg]",obj).click(function(){var url=$(this).attr("href");url=url.replace(/^.*\//,'');var title=$(this).attr("title")||"提示";$.msgbox({'title':title,'height':400,'width':550,'content':'json/'+url+'&s='+Math.random(),'type':'url'});return false});$("a[target=smsg]",obj).click(function(){var url=$(this).attr("href");url=url.replace(/^.*\//,'');var title=$(this).attr("title")||"提示";$.msgbox({'title':title,'height':178,'width':280,'content':'json/'+url+'&s='+Math.random(),'type':'url'});return false});var $menu=$("<div></div>").appendTo("body").attr("id","menu");$(".menu",obj).mouseover(function(){$menu.empty();$(this).find("ul").clone().appendTo($menu);var offset=$(this).offset();$menu.css({"position":"absolute","left":offset.left-12,"top":offset.top,"background":"#ffffff"});$("ul",$menu).hover(function(){$('a[target=confirm]',$(this)).click(function(){var title=$(this).attr("title")||'确实要'+$(this).text()+'吗？';var url=$(this).attr("href");url=url.replace(/^.*\//,'');$.confirm(title,function(){$.getJSON('json/'+url+"&s="+Math.random(),function(data){if(data.err){$.alert(data.err);}else if(data.msg){if(data.func){eval(data.func);return false;}else window.location.reload();}})});return false;});},function(){$menu.empty();});});$("table.pages",obj).page();$("a.username",obj).click(function(){var url=$(this).attr("href");$.msgbox({'title':'\u67E5\u770B\u4F1A\u5458\u8D44\u6599','height':176,'width':320,'content':'json/'+url+'&s='+Math.random(),'type':'url'});return false;});$("a[target=confirm]",obj).click(function(){var title=$(this).attr("title")||'确实要'+$(this).text()+'吗？';var url=$(this).attr("href");url=url.replace(/^.*\//,'');$.confirm(title,function(){$.getJSON('json/'+url+"&s="+Math.random(),function(data){if(data.err){$.alert(data.err);}else if(data.msg)window.location.reload();})});return false;});}


$.msgform=function($box){$("form",$box).each(function(){	
var $this=$(this);
var action=$this.attr("action")||"";action="json/"+action;var method=$this.attr("method")||"get";
var $p=$(document.createElement("p")).appendTo($box);$this.submit(function(){if(eval($this.attr("submit"))==false)return false;
var dataArr=new Array;
$("input[type=text],input[type=password],input[type=hidden],input[checked],textarea,select",$this).each(function(){dataArr.push(this.name+'='+escape(this.value.replace(/\%/g,"%25").replace(/\\/g,"%5C").replace(/\・/g,"%B7")).replace(/\+/g,"%2B"));});
if(method=='post'){$p.html('<img src="images/1000516.gif" /> 提交中…');
$.ajax({type:"POST",cache:false,url:action,data:dataArr.join('&'),dataType:"json",success:function(data){if(data.err){$p.html('<img src="images/1000216.gif" /> '+data.err);}else{$box.html('<img src="images/1000716.gif" /> '+data.msg);}if(data.func){eval(data.func);$("div.msg_bg").fade('slow');$("div.msg_wrapper").slideUp("slow");return false;}else if(data.reload){window.location.reload();return false;}else if(data.html){$box.load(data.html,function(){$.msgform($box);});}else if(data.url){$box.html($box.html()+"<a href=\""+data.url+"\">如果不跳转请点此</a>");setTimeout(function(){window.location.href=data.url;},2000);}},timeout:10000,global:false,error:function(){$p.html('<img src="images/1000216.gif" /> \u63D0\u4EA4\u5931\u8D25\uFF01');}});}else{$box.load(action+'?'+dataArr.join('&'));}return false;});});$("input[click]",$box).each(function(){eval($(this).attr("click"))});$("textarea#editor",$box).each(function(){$(this).xheditor(true,{tools:"simple"});});$("a[target=msg]",$box).click(function(){var url=$(this).attr("href");url=url.replace(/^.*\//,'');var title=$(this).attr("title")||"提示";$.msgbox({'title':title,'height':400,'width':550,'content':'json/'+url+'&s='+Math.random(),'type':'url'});return false;});$("a[target=_self]").click(function(){var url=$(this).attr("href");url=url.replace(/^.*\//,'');$box.load('json/'+url+'&s='+Math.random(),function(){$.msgform($box);});return false;});}
$.getBoardlist=function(){var $boardselect=$('#boardselect');$boardselect.css('display','inline');if($boardselect.text()==''){$boardselect.html('<img src="images/loading.gif" />');$boardselect.load('json/slist.asp');}}
$.ajaxUpload=function(fromfile,tourl,callback){var id=new Date().getTime(),idIO="jUploadFrame"+id;var jIO=$('<iframe name="'+idIO+'" class="xhEdtUploadIO" />').appendTo("body");var jForm=$('<form action="'+tourl+'" target="'+idIO+'" method="post" enctype="multipart/form-data" class="xhEdtUploadForm"></form>').appendTo("body");var jOldFile=$(fromfile),jNewFile=jOldFile.clone().attr("disabled","true");jOldFile.before(jNewFile).appendTo(jForm);jIO.load(function(){setTimeout(function(){jNewFile.before(jOldFile).remove();jIO.remove();jForm.remove()},100);var strText=$(jIO[0].contentWindow.document.body).text(),data=Object;try{eval("data="+strText)}catch(ex){}if(data.err!=undefined&&data.msg!=undefined){callback(data)}	});jForm.submit()};
$.onlineToggle=function(obj,bool){var $this=$(obj);$.getJSON('json/login.asp',{'action':'onlinetoggle','online':bool},function(data){if(data.msg){if(data.msg=="False"){$this.text('隐身');$this.attr("title","点此恢复上线");}else{$this.text('在线');$this.attr('title','点此转为隐身');}}});}
$.selectDate=function(obj,settings){var $d=new Date();var DateSettings={date:new Date(),startYear:$d.getFullYear()-10,endYear:$d.getFullYear()+15,dateFormat:"yyyy-mm-dd"};DateSettings=$.extend(DateSettings,settings);if(typeof(DateSettings.date)=="string"){nowDate=new Date();nowDate.setFullYear(parseInt(DateSettings.date.split("-")[0]));nowDate.setMonth(parseInt(DateSettings.date.split("-")[1])-1);nowDate.setDate(parseInt(DateSettings.date.split("-")[2]));}if(typeof(DateSettings.date)=="object"){nowDate=DateSettings.date};var showDate=function(obj){var strYear=new Array();var strMonth=new Array();var mon=new Array('一','二','三','四','五','六','七','八','九','十','十一','十二');for(var i=0;i<12;i++){if(i==nowDate.getMonth()){strMonth.push('<option value="'+(i+1)+'" selected="selected">'+mon[i]+'月</option>');}else{strMonth.push('<option value="'+(i+1)+'">'+mon[i]+'月</option>');}}for(var j=DateSettings.startYear;j<=DateSettings.endYear;j++){if(j==nowDate.getFullYear()){strYear.push('<option value="'+j+'" selected="selected">'+j+'年</option>');}else{strYear.push('<option value="'+j+'">'+j+'年</option>');}}var getDayStr=function(){var year;var month;var nextyear;var nextmonth;year=parseInt($year.val());month=parseInt($mon.val());var selectD=new Date(year,month-1,1);if(month==12){nextyear=year+1;nextmonth=0;}else{nextyear=year;nextmonth=month;}var $ul=$(document.createElement("ul")).addClass('day').appendTo($calenderBody).append('<li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li>');var nextD=new Date(nextyear,nextmonth,1);var $date=$(document.createElement('ul')).addClass('date').appendTo($calenderBody);var $day =parseInt(Math.abs(nextD-selectD)/1000/60/60/24);for(var ii=0;ii<selectD.getDay();ii++){$('<li> </li>').appendTo($date);}for(var nn=1;nn<=$day;nn++){if(nn==nowDate.getDate())$('<li class="today"><a href="#">'+nn+'</a></li>').appendTo($date);else $('<li><a href="#">'+nn+'</a></li>').appendTo($date);}$('li:eq(6),li:eq(13),li:eq(20),li:eq(27),li:eq(34)',$date).addClass('Sat');$('li:eq(0),li:eq(7),li:eq(14),li:eq(21),li:eq(28),li:eq(35)',$date).addClass('Sun');};var changeDate=function(){$calenderBody.empty();getDayStr();$('a',$calenderBody).click(function(){getdate($(this).text());return false;})};var pos=obj.offset();var pagesize=$.getPageSize();var y=(pagesize.PageH-200>pos.top)?pos.top+20:pos.top-182;var $calender=$(document.createElement('div')).addClass('calender').css({'left':pos.left,'top':y}).appendTo(document.body);var $close=$('<a href="#">&times;</a>').appendTo($calender).css('float','right').click(function(){$calender.fade('fast');return false;});var $year=$(document.createElement('select')).html(strYear.join("")).appendTo($calender).change(function(){changeDate();});var $mon=$(document.createElement('select')).html(strMonth.join("")).appendTo($calender).change(function(){changeDate();});var $calenderBody=$(document.createElement('div')).addClass('calenderBody').appendTo($calender);getDayStr();$('a',$calenderBody).click(function(){getdate($(this).text());return false;});$('<hr />').appendTo($calender);$('<a href="#">今天 </a>').appendTo($calender).click(function(){var y=nowDate.getFullYear();m=parseInt(nowDate.getMonth())+1;d=nowDate.getDate();filldate(y,m,d);return false;});$('<a href="#"> 清空</a>').appendTo($calender).click(function(){$(obj).val('');$calender.fade('fast');return false;});var getdate=function(day){var y=$year.val();var m=$mon.val();var d=day||nowDate.getDate();filldate(y,m,d)};var filldate=function(y,m,d){var returndate=DateSettings.dateFormat.replace("yyyy",y).replace("mm",m).replace("dd",d);$(obj).val(returndate);$calender.fade('slow');return false;}};showDate(obj);}
$.fn.slide=function(){var $slider=$(this);var $count=$("li",$slider).size();if($count<2)return false;var $index=1;var $ul=$("ul",$slider);$("li:eq(0)",$ul).css({"top":0});var $prev=$("<div>&laquo;</div>").addClass("right").css({"cursor":"pointer"}).prependTo($slider);var $countwrap=$("<div>"+$index+"/"+$count+"</div>").addClass("right").prependTo($slider);var $next=$("<div>&raquo;</div>").addClass("right").css({"cursor":"pointer"}).prependTo($slider);var toNext=function(){clearTimeout(TimeoutID);var $li=$("li",$slider);$li.eq(0).animate({"top":-20},500,function(){$(this).appendTo($ul).css({"top":20});});$li.eq(1).animate({"top":0},"slow");$index=parseInt($index)+1;if($index>$count)$index=1;$countwrap.text(""+$index+"/"+$count);TimeoutID=setTimeout(toNext,5000);};var toPrev=function(){clearTimeout(TimeoutID);var $li=$("li",$slider);$li.eq(0).animate({"top":20},500);$li.eq($li.length-1).prependTo($ul).css({"top":-20}).animate({"top":0},"slow");$index=parseInt($index)-1;if($index==0)$index=$count;$countwrap.text(""+$index+"/"+$count);TimeoutID=setTimeout(toNext,7000);};$next.click(toNext);$prev.click(toPrev);var TimeoutID=setTimeout(toNext,5000)}
$.fn.post=function(){$(this).each(function(){var $box=$(".tip",this);var $edit=$(".editpost",$box);$edit.click(function(){var url=$(this).attr("href");var he=parseInt($box.height());$box.css('height',he);$box.html('<img src="script/images/loading.gif" /> 载入中...');$box.load("json/"+url+"&s="+Math.random(),function(){$("textarea",$box).css({"height":(he-16),"width":"100%","max-height":400});$.msgform($box);});return false;});var $del=$(".del",$box);$del.one("click",function(){var url=$(this).attr("href");$.getJSON("json/"+url+"&s="+Math.random(),function(data){if(!data.err){$box.html("<div class=\"attention\">\u7BA1\u7406\u63D0\u793A\uFF1A\u672C\u8D34\u5185\u5BB9\u5DF2\u88AB\u5C4F\u853D</div>");}else{$.alert("\u4F60\u65E0\u6743\u5220\u9664\u8BE5\u8D34")}});return false;});$("a.reply,a.quote",$(this)).click(function(){var url=$(this).attr("href");$.get("json/"+url+"&s="+Math.random(),function(data){$editor.pasteHTML(ubb2html(data));window.location.hash="#reply";$editor.focus();});return false;});});}
function savepost(obj){var title=escape($("input[name=title]",obj).val().replace(/\%/g,"%25").replace(/\\/g,"%5C").replace(/\・/g,"%B7")).replace(/\+/g,"%2B");var pid=$("input[name=pid]",obj).val();var content=escape($("textarea[name=content]",obj).val().replace(/\%/g,"%25").replace(/\\/g,"%5C").replace(/\・/g,"%B7")).replace(/\+/g,"%2B");$.post("json/savepost.asp",{"title":title,"bid":0,"tid":0,"index":0,"pid":pid,"content":content},function(data){if(data.err)$.alert(data.err);obj.load("json/post.asp?pid="+pid+"&s="+Math.random());},"json");}
$.floatside=function(o){var setting={"top":60,"left":10,"right":10,"width":100,"height":400,"minScreenW":1024,"position":"left","allowClose":true,"content":"<span>\u7A7A\u767D\u5185\u5BB9</span>"};setting=$.extend(setting,o||{});if(setting.minScreenW>=$(window).width())return false;var $fdiv=$(document.createElement('div')).appendTo(document.body).html(setting.content);if (setting.position=='left'){$fdiv.css({"position":"absolute","left":setting.left,"top":setting.top,"zIndex":10});}	else{$fdiv.css({"position":"absolute","right":setting.right,"top":setting.top,"zIndex":10});}if(setting.allowClose==true){var $close=$('<p><a href="#">关闭</a></p>').appendTo($fdiv).click(function(){$fdiv.hide();return false});}$(window).scroll(function(){var Wscrol=$.getPageScroll();$fdiv.css("top",setting.top+Wscrol.Y);});}
$.floatrand=function(o){var setting={"top":120,"left":120,"width":100,"height":100,"allowClose":true,"content":"<span>\u7A7A\u767D\u5185\u5BB9</span>"};setting=$.extend(setting,o||{});var Wpage=$.getPageSize();var xon=1;var yon=1;var $scroY=0;var x=setting.left; var y=setting.top;var $rdiv=$(document.createElement('div')).appendTo(document.body).html(setting.content).css({"position":"absolute","background":"#ffffff","left":setting.left,"top":setting.top});setting.width=$rdiv.width();setting.height=$rdiv.height();if(setting.allowClose==true){var $close=$('<a href="#" style="float:right;">关闭</a>').appendTo($rdiv).css({"position":"absolute","right":4,"top":0}).click(function(){$rdiv.hide();return false});}function $float(){if(x>=Wpage.WinW-setting.width)xon=-1;if(y>=Wpage.WinH-setting.height)yon=-1;if(x==0)xon=1;if(y==0)yon=1;x=x+xon;y=y+yon;$rdiv.css({"left":x,"top":y+$scroY});}var $f=window.setInterval(function(){$float()},15);$rdiv.hover(function(){window.clearInterval($f);},function(){$f=window.setInterval(function(){$float()},10);});$(window).scroll(function(){Wscrol=$.getPageScroll();$scroY=Wscrol.Y;})}
$.fn.changePageTarget=function(){var $this=$(this);$.post('json/changapagetarget.asp',function(data){if(data=='0'){$this.attr('src','images/_blank.gif');$("a[target=_self]").attr('target','_blank');}else{$this.attr('src','images/_self.gif');$("a[target=_blank]").attr('target','_self');}});}
function checklogin(obj){var $username=$("input[name=username]",obj).val();var $password=$("input[name=password]",obj).val();var $p=$("<span></span>").insertAfter(obj);if($username.length<2){$p.html("<img src=\"images/1000216.gif\" /> \u7528\u6237\u540D\u4E0D\u6B63\u786E\uFF01");window.setTimeout(function(){$p.remove()},1000);return false;}var re=/^[\w\u4e00-\u9fa5]{2,}$/;if(re.test($username)==false){$p.html("<img src=\"images/1000216.gif\" /> \u7528\u6237\u540D\u4E0D\u6B63\u786E\uFF01");window.setTimeout(function(){$p.remove()},1000);return false;}if($password.length<6){$p.html("<img src=\"images/1000216.gif\" /> \u5BC6\u7801\u4E0D\u6B63\u786E");window.setTimeout(function(){$p.remove()},1000);return false;}re=/^[\w]{6,}$/;if(re.test($password)==false){$p.html("<img src=\"images/1000216.gif\" /> \u5BC6\u7801\u4E0D\u6B63\u786E");return false;}$p.remove();return true;}
function checkfrm(obj){if($("input[name=title]",obj).val().length<=1){$.alert('\u6C34\u4E0D\u662F\u8FD9\u4E48\u704C\u6EF4\uFF0C\u6807\u9898\u662F\u4E0D\u80FD\u592A\u77ED\u6EF4\uFF01');return false;}	if($("textarea[name=content]",obj).val().length<=10){$.alert('\u6C34\u4E0D\u662F\u8FD9\u4E48\u704C\u6EF4\uFF0C\u5185\u5BB9\u4E0D\u80FD\u592A\u77ED');return false;}	}
function checkvote(obj){var size=$("input[name=option][checked]",obj).size();if(size==0){$.alert('\u4F60\u6CA1\u6709\u9009\u4E2D\u4EFB\u4E00\u9879');return false;}};
$.fn.rate=function(options){options=options||{};options.rated=1;options.rateMax=options.rateMax||9;options.rateClass=options.rateClass||"star";options.rateOverClass 	=options.rateOverClass||"star_on";options.ratedClass= options.ratedClass||"star_yes";options.rateImg=options.rateImg||"images/star.gif";var $rate = function(wraper, options){var $wraper = $(wraper);var $rateUnits=[];for(var i=0; i<options.rateMax; i++){$rateUnits[i]=$(document.createElement("a"))	.attr("href","javascript:;").addClass(options.rateClass).attr("title",i+1);if(i<options.rated ) $rateUnits[i].addClass(options.ratedClass);$wraper.append($rateUnits[i]);}$.each($rateUnits, function(){$(this).hover(	function(){$(this).prevAll().add($(this)).addClass(options.rateOverClass) },function(){ $(this).prevAll().add($(this)).removeClass(options.rateOverClass)});$(this).click(function(){var index = $(this).attr("title");$("input",$wraper).val(index);$(this).prevAll().add($(this)).addClass(options.ratedClass);$(this).nextAll().removeClass(options.ratedClass);});});$wraper.removeClass();};$rate(this, options);return this;};function checkmsg(obj){var $incept=$("input[name=incept]",obj).val();var $content=$("textarea[name=content]",obj).val();var $p=$("<span></span>").insertAfter(obj);if($incept==''){$p.html("<img src=\"images/1000216.gif\" /> \u6536\u4FE1\u4EBA\u4E0D\u80FD\u4E3A\u7A7A\uFF01");window.setTimeout(function(){$p.remove()},1000);return false;}$p.remove();return true;};

function checkpassword(obj){var $opwd=$("input[name=oldpassword]",obj);var $pwd1=$("input[name=password1]",obj);var $pwd2=$("input[name=password2]",obj);if($opwd.val()==''){$opwd.after("<span><img src=\"images/1000216.gif\" /> \u65E7\u5BC6\u7801\u8F93\u5165\u4E0D\u6B63\u786E</span>");return false;}if($pwd1.val()==''){$pwd1.after("<span><img src=\"images/1000216.gif\" /> \u5BC6\u7801\u5FC5\u987B\u662F\u4E0D\u77ED\u4E8E6\u4F4D\u5B57\u6BCD\u6216\u6570\u5B57</span>");return false;}var re=/^[\w]{6,}$/;if(re.test($pwd1.val())==false){$pwd1.after("<span><img src=\"images/1000216.gif\" /> \u5BC6\u7801\u5FC5\u987B\u662F\u4E0D\u77ED\u4E8E6\u4F4D\u5B57\u6BCD\u6216\u6570\u5B57</span>");return false;}if($pwd2.val()!=$pwd1.val()){$pwd2.after('<span><img src=\"images/1000216.gif\" /> \u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4</span>');return false;}return true;}
})(jQuery);